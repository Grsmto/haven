<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Service Injection | Haven</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="GDPR-ready cookie consent manager with zero dependencies.">
    <link rel="preload" href="/haven/assets/css/0.styles.271a09f3.css" as="style"><link rel="preload" href="/haven/assets/js/app.57bef5de.js" as="script"><link rel="preload" href="/haven/assets/js/2.0cbc41d3.js" as="script"><link rel="preload" href="/haven/assets/js/13.c277a78d.js" as="script"><link rel="prefetch" href="/haven/assets/js/10.02e962ad.js"><link rel="prefetch" href="/haven/assets/js/11.00e65d73.js"><link rel="prefetch" href="/haven/assets/js/12.cc5f758b.js"><link rel="prefetch" href="/haven/assets/js/14.5ba6f552.js"><link rel="prefetch" href="/haven/assets/js/3.0010233d.js"><link rel="prefetch" href="/haven/assets/js/4.433fb063.js"><link rel="prefetch" href="/haven/assets/js/5.d22885d8.js"><link rel="prefetch" href="/haven/assets/js/6.de5f8522.js"><link rel="prefetch" href="/haven/assets/js/7.45fe0f0a.js"><link rel="prefetch" href="/haven/assets/js/8.9745dc5e.js"><link rel="prefetch" href="/haven/assets/js/9.cb83752e.js">
    <link rel="stylesheet" href="/haven/assets/css/0.styles.271a09f3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/haven/" class="home-link router-link-active"><!----> <span class="site-name">Haven</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/haven/" class="sidebar-link">Introduction</a></li><li><a href="/haven/getting-started.html" class="sidebar-link">Getting Started</a></li><li><a href="/haven/cookie-purposes.html" class="sidebar-link">Purposes</a></li><li><a href="/haven/service-injection.html" class="active sidebar-link">Service Injection</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/haven/service-injection.html#configuring-services" class="sidebar-link">Configuring services</a></li><li class="sidebar-sub-header"><a href="/haven/service-injection.html#custom-injectors" class="sidebar-link">Custom Injectors</a></li></ul></li><li><a href="/haven/cookie-notification.html" class="sidebar-link">Cookie Notification</a></li><li><a href="/haven/cookie-preferences.html" class="sidebar-link">Cookie Preferences</a></li><li><a href="/haven/consent-revoke.html" class="sidebar-link">Consent Revoke</a></li><li><a href="/haven/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/haven/events.html" class="sidebar-link">Events</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="service-injection"><a href="#service-injection" class="header-anchor">#</a> Service Injection</h1> <p>Haven ensures your website is GDPR-compliant by only <em>injecting</em> third party services
once the user has given his consent. So instead of having the following code snippet
somewhere in your HTML...</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- Google Analytics --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span>s<span class="token punctuation">,</span>o<span class="token punctuation">,</span>g<span class="token punctuation">,</span>r<span class="token punctuation">,</span>a<span class="token punctuation">,</span>m</span><span class="token punctuation">)</span><span class="token punctuation">{</span>i<span class="token punctuation">[</span><span class="token string">'GoogleAnalyticsObject'</span><span class="token punctuation">]</span><span class="token operator">=</span>r<span class="token punctuation">;</span>i<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token operator">||</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token punctuation">(</span>i<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span>q<span class="token operator">=</span>i<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span>q<span class="token operator">||</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>i<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span>l<span class="token operator">=</span><span class="token number">1</span><span class="token operator">*</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">,</span>
m<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span>async<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span>src<span class="token operator">=</span>g<span class="token punctuation">;</span>m<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>m<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span>document<span class="token punctuation">,</span><span class="token string">'script'</span><span class="token punctuation">,</span><span class="token string">'https://www.google-analytics.com/analytics.js'</span><span class="token punctuation">,</span><span class="token string">'ga'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ga</span><span class="token punctuation">(</span><span class="token string">'create'</span><span class="token punctuation">,</span> <span class="token string">'UA-XXXXX-Y'</span><span class="token punctuation">,</span> <span class="token string">'auto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">ga</span><span class="token punctuation">(</span><span class="token string">'send'</span><span class="token punctuation">,</span> <span class="token string">'pageview'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- End Google Analytics --&gt;</span>
</code></pre></div><p>... you would instead tell Haven to inject this service at runtime. This should be done
for all third party services. Haven comes with the following services out of the box:</p> <ul><li>Google Analytics</li> <li>Google Tag Manager</li> <li>Facebook Pixel</li></ul> <h2 id="configuring-services"><a href="#configuring-services" class="header-anchor">#</a> Configuring services</h2> <p>The Haven configuration object takes a list of services:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Haven<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    services<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Each service may specify the following options:</p> <table><thead><tr><th>Option</th> <th>Details</th> <th>Required</th></tr></thead> <tbody><tr><td><code>name</code></td> <td>Name of the service. The value is used to determine whether a service has already been injected, and should thus be <strong>unique</strong>.</td> <td><em>true</em></td></tr> <tr><td><code>purposes</code></td> <td>List of cookie purposes that apply to this service. The service will only be injected if <em>all</em> of the purposes have been consented to by the user. The purposes available by default are: <code>functional</code>, <code>analytics</code>, <code>marketing</code>, <code>preferences</code>. When specifying custom purposes, please make sure you provide a corresponding translation entry.</td> <td><em>true</em></td></tr> <tr><td><code>type</code></td> <td>If you wish to make use of the default injectors provided by Haven, make sure you use one of the following types: <code>google-analytics</code>, <code>google-tag-manager</code> or <code>facebook-pixel</code>.</td> <td><em>false</em></td></tr> <tr><td><code>inject</code></td> <td>The value may be a boolean or a custom injector function (see <a href="#custom-injectors">Custom Injectors</a>). When set to <code>true</code>, it will attempt to use a default injector.</td> <td><em>false</em></td></tr> <tr><td><code>required</code></td> <td>Boolean value that describes whether the service is required. When true, the service will <em>always</em> be injected, no matter the consent.</td> <td><em>false</em></td></tr> <tr><td><code>cookies</code></td> <td>Array of cookie names provided by this service. The names may be strings or regular expressions. Haven will delete these cookies when the user revokes his consent. Cookies for any of the default injectors do not need to be specified here.</td> <td><em>false</em></td></tr> <tr><td><code>options</code></td> <td>Optional options passed to the injector function. When using a default injector, specify your Google Analyitcs / Google Tag Manager / Facebook Pixel ID here (<code>options.id</code>)</td> <td><em>false</em></td></tr></tbody></table> <h2 id="custom-injectors"><a href="#custom-injectors" class="header-anchor">#</a> Custom Injectors</h2> <p>The <code>inject</code> property of a given service may also be a function which will then get called by Haven to inject the service once all prerequisites have been met.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Haven<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    services<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'custom-script'</span><span class="token punctuation">,</span>
            purposes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'analytics'</span><span class="token punctuation">,</span> <span class="token string">'custom-purpose'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token function-variable function">inject</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  				<span class="token keyword">const</span> firstScript <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  				<span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  				script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://some-custom-script-source</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  				firstScript<span class="token punctuation">.</span>parentNode<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>script<span class="token punctuation">,</span> firstScript<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/6/2019, 4:04:53 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/haven/cookie-purposes.html" class="prev">
        Purposes
      </a></span> <span class="next"><a href="/haven/cookie-notification.html">
        Cookie Notification
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/haven/assets/js/app.57bef5de.js" defer></script><script src="/haven/assets/js/2.0cbc41d3.js" defer></script><script src="/haven/assets/js/13.c277a78d.js" defer></script>
  </body>
</html>
