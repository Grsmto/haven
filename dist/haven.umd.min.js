/*!
 * haven v1.0.0
 * (c) Elisha Witte <elishawitte@gmail.com>
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).haven={})}(this,function(e){"use strict";var t,i=(function(e,t){var i;i=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var o in i)t[o]=i[o]}return t}return function t(i){function o(t,n,a){var s;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(a=e({path:"/"},o.defaults,a)).expires){var c=new Date;c.setMilliseconds(c.getMilliseconds()+864e5*a.expires),a.expires=c}a.expires=a.expires?a.expires.toUTCString():"";try{s=JSON.stringify(n),/^[\{\[]/.test(s)&&(n=s)}catch(e){}n=i.write?i.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var r="";for(var u in a)a[u]&&(r+="; "+u,!0!==a[u]&&(r+="="+a[u]));return document.cookie=t+"="+n+r}t||(s={});for(var l=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,h=0;h<l.length;h++){var f=l[h].split("="),p=f.slice(1).join("=");this.json||'"'!==p.charAt(0)||(p=p.slice(1,-1));try{var k=f[0].replace(d,decodeURIComponent);if(p=i.read?i.read(p,k):i(p,k)||p.replace(d,decodeURIComponent),this.json)try{p=JSON.parse(p)}catch(e){}if(t===k){s=p;break}t||(s[k]=p)}catch(e){}}return s}}return o.set=o,o.get=function(e){return o.call(o,e)},o.getJSON=function(){return o.apply({json:!0},[].slice.call(arguments))},o.defaults={},o.remove=function(t,i){o(t,"",e(i,{expires:-1}))},o.withConverter=t,o}(function(){})},e.exports=i()}(t={exports:{}},t.exports),t.exports),o=new(function(){function e(){this.subscriptions={},this.counter=0}return e.prototype.on=function(e,t){var i=this,o=this.counter++;return void 0===this.subscriptions[e]&&(this.subscriptions[e]={}),this.subscriptions[e][o]=t,{unsubscribe:function(){delete i.subscriptions[e][o]}}},e.prototype.emit=function(e,t){if(void 0!==this.subscriptions[e])for(var i=0,o=Object.keys(this.subscriptions[e]);i<o.length;i++){var n=o[i];this.subscriptions[e][n](t)}},e}()),n=function(){function e(e){var t=void 0===e?{}:e,i=t.prefix,o=t.type;this.type=o||"opt-in",this.prefix=i}return e.getCookie=function(e){return i.get(e)},e.setCookie=function(e,t,o){i.set(e,t,o||{})},e.removeCookie=function(e,t){i.remove(e,t)},e.cookieExists=function(e){return void 0!==i.get(e)&&""!==i.get(e)},e.prototype.enableFunctionalCookie=function(){e.setCookie(this.getPrefixedCookieName("functional"),"true",{expires:365}),o.emit("functional-enabled")},e.prototype.disableFunctionalCookie=function(){e.removeCookie(this.getPrefixedCookieName("functional"))},e.prototype.hasFunctionalCookie=function(){return e.cookieExists(this.getPrefixedCookieName("functional"))},e.prototype.enableAnalyticsCookie=function(){e.setCookie(this.getPrefixedCookieName("analytics"),"true",{expires:365}),o.emit("analytics-enabled")},e.prototype.disableAnalyticsCookie=function(){e.setCookie(this.getPrefixedCookieName("analytics"),"false",{expires:365}),o.emit("analytics-disabled")},e.prototype.hasAnalyticsEnabled=function(){var t=e.getCookie(this.getPrefixedCookieName("analytics"));return"opt-in"===this.type?"true"===t:void 0===t||"true"===t},e.prototype.enableMarketingCookie=function(){e.setCookie(this.getPrefixedCookieName("marketing"),"true",{expires:365}),o.emit("marketing-enabled")},e.prototype.disableMarketingCookie=function(){e.setCookie(this.getPrefixedCookieName("marketing"),"false",{expires:365}),o.emit("marketing-disabled")},e.prototype.hasMarketingEnabled=function(){var t=e.getCookie(this.getPrefixedCookieName("marketing"));return"opt-in"===this.type?"true"===t:void 0===t||"true"===t},e.prototype.acceptAll=function(){this.enableFunctionalCookie(),this.enableAnalyticsCookie(),this.enableMarketingCookie()},e.prototype.getPrefixedCookieName=function(e){return void 0!==this.prefix?this.prefix+"-"+e:e},e}(),a=function(){function e(e){this.cookieNotification=null,this.cookiesAccept=null,this.cookiesDecline=null,this.cookieManager=new n(e)}return e.prototype.init=function(){var e=this;this.cookieNotification=document.getElementById("cookie-notification"),this.cookiesAccept=document.getElementById("cookie-notification__accept"),this.cookiesDecline=document.getElementById("cookie-notification__decline"),null===this.cookieNotification||this.cookieManager.hasFunctionalCookie()||this.showCookieNotification(),null!==this.cookiesAccept&&this.cookiesAccept.addEventListener("click",function(t){t.preventDefault(),e.cookieManager.acceptAll(),e.hideCookieNotification()}),null!==this.cookiesDecline&&this.cookiesDecline.addEventListener("click",function(t){t.preventDefault(),e.cookieManager.enableFunctionalCookie(),e.hideCookieNotification()})},e.prototype.showCookieNotification=function(){null!==this.cookieNotification&&(this.cookieNotification.style.display="block")},e.prototype.hideCookieNotification=function(){null!==this.cookieNotification&&(this.cookieNotification.style.display="none")},e}(),s=function(){function e(e){this.checkboxAnalytics=null,this.checkboxMarketing=null,this.saveButton=null,this.saveButtonInitialText="",this.saveButtonSavedText="",this.cookieManager=new n(e)}return e.prototype.init=function(){var e=this;this.checkboxAnalytics=document.getElementById("cookie-preferences__analytics"),this.checkboxMarketing=document.getElementById("cookie-preferences__marketing"),this.saveButton=document.getElementById("cookie-preferences__save"),null!==this.checkboxMarketing&&(this.checkboxMarketing.checked=this.cookieManager.hasMarketingEnabled(),this.checkboxAnalytics.addEventListener("change",function(){e.enableButton()})),null!==this.checkboxAnalytics&&(this.checkboxAnalytics.checked=this.cookieManager.hasAnalyticsEnabled(),this.checkboxMarketing.addEventListener("change",function(){e.enableButton()})),null!==this.saveButton&&(this.saveButtonInitialText=this.saveButton.innerText,this.saveButtonSavedText=this.saveButton.dataset.saved||"Saved",this.saveButton.addEventListener("click",function(){e.disableButton(),e.cookieManager.enableFunctionalCookie(),e.checkboxMarketing&&e.checkboxMarketing.checked?e.cookieManager.enableMarketingCookie():e.cookieManager.disableMarketingCookie(),e.checkboxAnalytics&&e.checkboxAnalytics.checked?e.cookieManager.enableAnalyticsCookie():e.cookieManager.disableAnalyticsCookie()}))},e.prototype.enableButton=function(){this.saveButton.disabled=!1,this.saveButton.innerText=this.saveButtonInitialText},e.prototype.disableButton=function(){this.saveButton.disabled=!0,this.saveButton.innerText=this.saveButtonSavedText},e}(),c=function(){function e(e){this.services=e.services||{}}return e.prototype.loadAnalyticsServices=function(){this.services.gtm&&this.services.gtm.id?this.loadGtm():this.services.ga&&this.services.ga.id&&this.loadGa(),o.emit("services-loaded")},e.prototype.loadGtm=function(){if(!this.hasLoadedGtm()){window.dataLayer=window.dataLayer||[],window.dataLayer.push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var e=document.getElementsByTagName("script")[0],t=document.createElement("script");t.src="https://www.googletagmanager.com/gtm.js?id="+this.services.gtm.id,e.parentNode.insertBefore(t,e)}},e.prototype.loadGa=function(){if(!this.hasLoadedGa()){window.ga=window.ga||function(){(window.ga.q=window.ga.q||[]).push(arguments)},window.ga.l=+new Date;var e=document.getElementsByTagName("script")[0],t=document.createElement("script");t.src="https://www.google-analytics.com/analytics.js",e.parentNode.insertBefore(t,e),window.ga("create",this.services.ga.id,"auto"),window.ga("send","pageview")}},e.prototype.hasLoadedGtm=function(){var e="https://www.googletagmanager.com/gtm.js?id="+this.services.gtm.id;return null!==document.querySelector('script[src="'+e+'"')},e.prototype.hasLoadedGa=function(){return null!==document.querySelector('script[src="https://www.google-analytics.com/analytics.js"')},e}(),r=function(){function e(){}return e.resolve=function(e){return void 0===e.domain&&(e.domain=this.getDomain()),e.domain&&!e.domain.startsWith(".")&&(e.domain="."+e.domain),Object.assign({type:"opt-in",injectServices:!0,injectBothGtmAndGa:!1},e)},e.getDomain=function(){var e=window.location.hostname,t=e.match(/(?:[A-Za-z0-9-]+\.)*([A-Za-z0-9-]+\.co.uk|\.com.br|\.co.jp|\.com.au)\b/);if(null!==t)return t[1];var i=e.match(/(?:[A-Za-z0-9-]+\.)*([A-Za-z0-9-]+\.(?:[A-za-z]{2}|[A-Za-z]{3,}))\b/);return null!==i?i[1]:void 0},e}(),u=function(){function e(e){this.services=e.services||{},this.domain=e.domain}return e.prototype.destroyAnalyticsServices=function(){this.services.gtm&&this.services.gtm.id&&this.destroyGtm(),this.services.aam&&this.destroyAam(),this.services.navitas&&this.destroyNavitas(),window.location.reload()},e.prototype.destroyGtm=function(){for(var e=0,t=["_ga","_gid","_gat"];e<t.length;e++){var i=t[e];this.domain&&n.removeCookie(i,{domain:this.domain}),n.removeCookie(i)}if(this.services.ga&&this.services.ga.id)for(var o=0,a=["_dc_gtm_","_gac_","_gat_gtag_","_gat_"];o<a.length;o++){i=a[o];this.domain&&n.removeCookie(""+i+this.services.ga.id,{domain:this.domain}),n.removeCookie(""+i+this.services.ga.id)}},e.prototype.destroyAam=function(){n.removeCookie("aam_uuid")},e.prototype.destroyNavitas=function(){n.removeCookie("AAMC_navitas_0"),n.removeCookie("DST"),n.removeCookie("demdex"),n.removeCookie("dextp"),n.removeCookie("navitas")},e}(),l=function(){function e(e){var t=r.resolve(e);this.cookieNotification=new a(t),this.cookiePreferences=new s(t),this.cookieManager=new n(t),this.serviceLoader=new c(t),this.consentRevoke=new u(t),this.options=t}return e.prototype.init=function(){var e=this;document.addEventListener("DOMContentLoaded",function(){e.cookieNotification.init(),e.cookiePreferences.init()}),this.registerDefaultListeners(),this.checkInitialState()},e.prototype.checkInitialState=function(){this.cookieManager.hasFunctionalCookie()&&o.emit("functional-enabled"),this.cookieManager.hasAnalyticsEnabled()&&o.emit("analytics-enabled"),this.cookieManager.hasMarketingEnabled()&&o.emit("marketing-enabled")},e.prototype.registerDefaultListeners=function(){var e=this;o.on("analytics-enabled",function(){e.options.injectServices&&e.serviceLoader.loadAnalyticsServices()}),o.on("analytics-disabled",function(){e.consentRevoke.destroyAnalyticsServices()})},e.prototype.getOptions=function(){return this.options},e.on=function(e,t){return o.on(e,t)},e.create=function(t){var i=new e(t);return i.init(),i},e.removeCookies=function(e,t){for(var i=0,o=e;i<o.length;i++){var a=o[i];n.removeCookie(a,t)}},e}();window.Haven=l,e.CookieConsent=l,e.CookieManager=n,e.CookieNotification=a,e.CookiePreferences=s,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=haven.umd.min.js.map
