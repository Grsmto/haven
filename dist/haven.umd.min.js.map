{"version":3,"file":"haven.umd.min.js","sources":["../node_modules/js-cookie/src/js.cookie.js","../src/event-bus.ts","../src/cookie-manager.ts","../src/cookie-notification.ts","../src/cookie-preferences.ts","../src/service-loader.ts","../src/configuration-resolver.ts","../src/consent-revoke.ts","../src/cookie-consent.ts","../src/index.umd.ts"],"sourcesContent":["/*!\n * JavaScript Cookie v2.2.0\n * https://github.com/js-cookie/js-cookie\n *\n * Copyright 2006, 2015 Klaus Hartl & Fagner Brack\n * Released under the MIT license\n */\n;(function (factory) {\n\tvar registeredInModuleLoader = false;\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(factory);\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (typeof exports === 'object') {\n\t\tmodule.exports = factory();\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (!registeredInModuleLoader) {\n\t\tvar OldCookies = window.Cookies;\n\t\tvar api = window.Cookies = factory();\n\t\tapi.noConflict = function () {\n\t\t\twindow.Cookies = OldCookies;\n\t\t\treturn api;\n\t\t};\n\t}\n}(function () {\n\tfunction extend () {\n\t\tvar i = 0;\n\t\tvar result = {};\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar attributes = arguments[ i ];\n\t\t\tfor (var key in attributes) {\n\t\t\t\tresult[key] = attributes[key];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction init (converter) {\n\t\tfunction api (key, value, attributes) {\n\t\t\tvar result;\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Write\n\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tattributes = extend({\n\t\t\t\t\tpath: '/'\n\t\t\t\t}, api.defaults, attributes);\n\n\t\t\t\tif (typeof attributes.expires === 'number') {\n\t\t\t\t\tvar expires = new Date();\n\t\t\t\t\texpires.setMilliseconds(expires.getMilliseconds() + attributes.expires * 864e+5);\n\t\t\t\t\tattributes.expires = expires;\n\t\t\t\t}\n\n\t\t\t\t// We're using \"expires\" because \"max-age\" is not supported by IE\n\t\t\t\tattributes.expires = attributes.expires ? attributes.expires.toUTCString() : '';\n\n\t\t\t\ttry {\n\t\t\t\t\tresult = JSON.stringify(value);\n\t\t\t\t\tif (/^[\\{\\[]/.test(result)) {\n\t\t\t\t\t\tvalue = result;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\n\t\t\t\tif (!converter.write) {\n\t\t\t\t\tvalue = encodeURIComponent(String(value))\n\t\t\t\t\t\t.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = converter.write(value, key);\n\t\t\t\t}\n\n\t\t\t\tkey = encodeURIComponent(String(key));\n\t\t\t\tkey = key.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\n\t\t\t\tkey = key.replace(/[\\(\\)]/g, escape);\n\n\t\t\t\tvar stringifiedAttributes = '';\n\n\t\t\t\tfor (var attributeName in attributes) {\n\t\t\t\t\tif (!attributes[attributeName]) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tstringifiedAttributes += '; ' + attributeName;\n\t\t\t\t\tif (attributes[attributeName] === true) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tstringifiedAttributes += '=' + attributes[attributeName];\n\t\t\t\t}\n\t\t\t\treturn (document.cookie = key + '=' + value + stringifiedAttributes);\n\t\t\t}\n\n\t\t\t// Read\n\n\t\t\tif (!key) {\n\t\t\t\tresult = {};\n\t\t\t}\n\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all. Also prevents odd result when\n\t\t\t// calling \"get()\"\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\n\t\t\tvar rdecode = /(%[0-9A-Z]{2})+/g;\n\t\t\tvar i = 0;\n\n\t\t\tfor (; i < cookies.length; i++) {\n\t\t\t\tvar parts = cookies[i].split('=');\n\t\t\t\tvar cookie = parts.slice(1).join('=');\n\n\t\t\t\tif (!this.json && cookie.charAt(0) === '\"') {\n\t\t\t\t\tcookie = cookie.slice(1, -1);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tvar name = parts[0].replace(rdecode, decodeURIComponent);\n\t\t\t\t\tcookie = converter.read ?\n\t\t\t\t\t\tconverter.read(cookie, name) : converter(cookie, name) ||\n\t\t\t\t\t\tcookie.replace(rdecode, decodeURIComponent);\n\n\t\t\t\t\tif (this.json) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === name) {\n\t\t\t\t\t\tresult = cookie;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!key) {\n\t\t\t\t\t\tresult[name] = cookie;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tapi.set = api;\n\t\tapi.get = function (key) {\n\t\t\treturn api.call(api, key);\n\t\t};\n\t\tapi.getJSON = function () {\n\t\t\treturn api.apply({\n\t\t\t\tjson: true\n\t\t\t}, [].slice.call(arguments));\n\t\t};\n\t\tapi.defaults = {};\n\n\t\tapi.remove = function (key, attributes) {\n\t\t\tapi(key, '', extend(attributes, {\n\t\t\t\texpires: -1\n\t\t\t}));\n\t\t};\n\n\t\tapi.withConverter = init;\n\n\t\treturn api;\n\t}\n\n\treturn init(function () {});\n}));\n","interface EventBusSubscriptions {\n  [name: string]: {\n    [id: number]: Function;\n  };\n}\n\nexport interface EventBusSubscription {\n  unsubscribe: Function;\n}\n\nclass EventBus {\n  private subscriptions: EventBusSubscriptions = {};\n  private counter: number = 0;\n\n  /**\n   * Register a new callback\n   * @param event\n   * @param callback\n   */\n  on(event: string, callback: Function): EventBusSubscription {\n    const id = this.counter++;\n    if (this.subscriptions[event] === undefined) {\n      this.subscriptions[event] = {};\n    }\n\n    this.subscriptions[event][id] = callback;\n\n    return {\n      unsubscribe: () => {\n        delete this.subscriptions[event][id];\n      }\n    }\n  }\n\n  /**\n   * Emit a new event\n   * @param event\n   * @param payload\n   */\n  emit(event: string, payload?: any): void {\n    if (this.subscriptions[event] === undefined) {\n      return;\n    }\n\n    for (const id of Object.keys(this.subscriptions[event])) {\n      this.subscriptions[event][id](payload);\n    }\n  }\n}\n\nexport default new EventBus();\n","import Cookies, { CookieAttributes } from 'js-cookie';\nimport { ConsentType, CookieManagerOptions } from '../types';\nimport EventBus from './event-bus';\n\nexport default class CookieManager {\n  /**\n   * Consent type: opt-in / opt-out.\n   */\n  protected type: ConsentType;\n\n  /**\n   * Optional cookie prefix\n   */\n  protected prefix: string | undefined;\n\n  /**\n   * Create CookieManager instance.\n   * @param prefix\n   * @param type\n   */\n  constructor({ prefix, type }: CookieManagerOptions = {}) {\n    this.type = type || 'opt-in';\n    this.prefix = prefix;\n  }\n\n  /**\n   * Get cookie by name.\n   * @param name\n   */\n  public static getCookie(name: string): string | undefined {\n    return Cookies.get(name);\n  }\n\n  /**\n   * Set cookie by name.\n   * @param name\n   * @param value\n   * @param options\n   */\n  public static setCookie(name: string, value: string, options?: CookieAttributes): void {\n    Cookies.set(name, value, options || {});\n  }\n\n  /**\n   * Remove cookie by name.\n   * @param name\n   * @param options\n   */\n  public static removeCookie(name: string, options?: CookieAttributes): void {\n    Cookies.remove(name, options);\n  }\n\n  /**\n   * Check whether cookie exists.\n   * @param name\n   */\n  public static cookieExists(name: string): boolean {\n    return Cookies.get(name) !== undefined && Cookies.get(name) !== '';\n  }\n\n  /**\n   * Enable the functional cookie.\n   */\n  public enableFunctionalCookie(): void {\n    CookieManager.setCookie(this.getPrefixedCookieName('functional'), 'true', { expires: 365 });\n    EventBus.emit('functional-enabled');\n  }\n\n  /**\n   * Disable (remove) functional cookie, resulting in new cookie consent request.\n   */\n  public disableFunctionalCookie(): void {\n    CookieManager.removeCookie(this.getPrefixedCookieName('functional'));\n  }\n\n  /**\n   * Check whether the functional cookie has been set.\n   */\n  public hasFunctionalCookie(): boolean {\n    return CookieManager.cookieExists(this.getPrefixedCookieName('functional'));\n  }\n\n  /**\n   * Enable analytics cookie.\n   */\n  public enableAnalyticsCookie(): void {\n    CookieManager.setCookie(this.getPrefixedCookieName('analytics'), 'true', { expires: 365 });\n    EventBus.emit('analytics-enabled');\n  }\n\n  /**\n   * Disable analytics cookie.\n   */\n  public disableAnalyticsCookie(): void {\n    CookieManager.setCookie(this.getPrefixedCookieName('analytics'), 'false', { expires: 365 });\n    EventBus.emit('analytics-disabled');\n  }\n\n  /**\n   * Check whether analytics cookies should be enabled.\n   */\n  public hasAnalyticsEnabled(): boolean {\n    const cookie = CookieManager.getCookie(this.getPrefixedCookieName('analytics'));\n\n    if (this.type === 'opt-in') {\n      return cookie === 'true';\n    }\n\n    return cookie === undefined || cookie === 'true';\n  }\n\n  /**\n   * Enable the marketing cookie.\n   */\n  public enableMarketingCookie(): void {\n    CookieManager.setCookie(this.getPrefixedCookieName('marketing'), 'true', { expires: 365 });\n    EventBus.emit('marketing-enabled');\n  }\n\n  /**\n   * Disable the marketing cookie.\n   */\n  public disableMarketingCookie(): void {\n    CookieManager.setCookie(this.getPrefixedCookieName('marketing'), 'false', { expires: 365 });\n    EventBus.emit('marketing-disabled');\n  }\n\n  /**\n   * Check whether marketing cookies should be enabled.\n   */\n  public hasMarketingEnabled(): boolean {\n    const cookie = CookieManager.getCookie(this.getPrefixedCookieName('marketing'));\n\n    if (this.type === 'opt-in') {\n      return cookie === 'true';\n    }\n\n    return cookie === undefined || cookie === 'true';\n  }\n\n  /**\n   * Accept all cookies.\n   */\n  public acceptAll(): void {\n    this.enableFunctionalCookie();\n    this.enableAnalyticsCookie();\n    this.enableMarketingCookie();\n  }\n\n  /**\n   * Get prefixed cookie name, if a prefix has been set by the user.\n   * @param name\n   */\n  protected getPrefixedCookieName(name: string): string {\n    if (this.prefix !== undefined) {\n      return `${this.prefix}-${name}`;\n    }\n\n    return name;\n  }\n}\n","import CookieManager from './cookie-manager';\nimport { Configuration } from '../types';\n\nexport default class CookieNotification {\n  /**\n   * Cookie manager instance.\n   */\n  protected cookieManager: CookieManager;\n  /**\n   * Wrapper element for the cookie notification.\n   */\n  protected cookieNotification: HTMLElement | null = null;\n  /**\n   * Button for accepting cookies.\n   */\n  protected cookiesAccept: HTMLElement | null = null;\n  /**\n   * Button for declining cookies.\n   */\n  protected cookiesDecline: HTMLElement | null = null;\n\n  /**\n   * Fetch DOM elements.\n   */\n  constructor(options: Configuration) {\n    this.cookieManager = new CookieManager(options);\n  }\n\n  /**\n   * Initialize cookie notification event listeners.\n   */\n  public init(): void {\n    this.cookieNotification = document.getElementById('cookie-notification');\n    this.cookiesAccept = document.getElementById('cookie-notification__accept');\n    this.cookiesDecline = document.getElementById('cookie-notification__decline');\n\n    if (this.cookieNotification !== null && !this.cookieManager.hasFunctionalCookie()) {\n      this.showCookieNotification();\n    }\n    if (this.cookiesAccept !== null) {\n      this.cookiesAccept.addEventListener('click', (event) => {\n        event.preventDefault();\n        this.cookieManager.acceptAll();\n        this.hideCookieNotification();\n      })\n    }\n    if (this.cookiesDecline !== null) {\n      this.cookiesDecline.addEventListener('click', (event) => {\n        event.preventDefault();\n        // Only set the functional cookie.\n        this.cookieManager.enableFunctionalCookie();\n        this.hideCookieNotification();\n      })\n    }\n  }\n\n  /**\n   * Show cookie notification.\n   */\n  public showCookieNotification(): void {\n    if (this.cookieNotification !== null) {\n      this.cookieNotification.style.display = 'block';\n    }\n  }\n\n  /**\n   * Hide cookie notification.\n   */\n  public hideCookieNotification(): void {\n    if (this.cookieNotification !== null) {\n      this.cookieNotification.style.display = 'none';\n    }\n  }\n}\n","import CookieManager from './cookie-manager';\nimport { Configuration } from '../types';\n\nexport default class CookiePreferences {\n  /**\n   * Cookie manager instance.\n   */\n  protected cookieManager: CookieManager;\n  /**\n   * Checkbox for accepting analytics cookies.\n   */\n  protected checkboxAnalytics: HTMLInputElement | null = null;\n  /**\n   * Checkbox for accepting marketing cookies.\n   */\n  protected checkboxMarketing: HTMLInputElement | null = null;\n  /**\n   * Button for saving preferences.\n   */\n  protected saveButton: HTMLButtonElement | null = null;\n  /**\n   * Initial save button text (e.g. `Save preferences`)\n   */\n  protected saveButtonInitialText: string = '';\n  /**\n   * Saved button text (e.g. `Saved`)\n   */\n  protected saveButtonSavedText: string = '';\n\n  /**\n   * Fetch DOM elements.\n   */\n  constructor(options: Configuration) {\n    this.cookieManager = new CookieManager(options);\n  }\n\n  /**\n   * Initialize cookie preferences initial states and event listeners.\n   */\n  public init(): void {\n    this.checkboxAnalytics = <HTMLInputElement>document.getElementById('cookie-preferences__analytics');\n    this.checkboxMarketing = <HTMLInputElement>document.getElementById('cookie-preferences__marketing');\n    this.saveButton = <HTMLButtonElement>document.getElementById('cookie-preferences__save');\n\n    // Set initial checked states\n    if (this.checkboxMarketing !== null) {\n      this.checkboxMarketing.checked = this.cookieManager.hasMarketingEnabled();\n      this.checkboxAnalytics.addEventListener('change', () => {\n        this.enableButton();\n      });\n    }\n    if (this.checkboxAnalytics !== null) {\n      this.checkboxAnalytics.checked = this.cookieManager.hasAnalyticsEnabled();\n      this.checkboxMarketing.addEventListener('change', () => {\n        this.enableButton();\n      });\n    }\n\n    if (this.saveButton !== null) {\n      this.saveButtonInitialText = this.saveButton.innerText;\n      this.saveButtonSavedText = this.saveButton.dataset.saved || 'Saved';\n      this.saveButton.addEventListener('click', () => {\n        this.disableButton();\n        this.cookieManager.enableFunctionalCookie();\n        if (this.checkboxMarketing && this.checkboxMarketing.checked) {\n          this.cookieManager.enableMarketingCookie();\n        } else {\n          this.cookieManager.disableMarketingCookie();\n        }\n        if (this.checkboxAnalytics && this.checkboxAnalytics.checked) {\n          this.cookieManager.enableAnalyticsCookie();\n        } else {\n          this.cookieManager.disableAnalyticsCookie();\n        }\n      })\n    }\n  }\n\n  /**\n   * Enable the submit button.\n   */\n  protected enableButton(): void {\n    this.saveButton!.disabled = false;\n    this.saveButton!.innerText = this.saveButtonInitialText;\n  }\n\n  /**\n   * Disable the submit button.\n   */\n  protected disableButton(): void {\n    this.saveButton!.disabled = true;\n    this.saveButton!.innerText = this.saveButtonSavedText;\n  }\n}\n","import { Configuration, CookieConsentServices, InjectableService } from '../types';\nimport EventBus from './event-bus';\n\nexport default class ServiceLoader {\n  protected inject: InjectableService[];\n  protected services: CookieConsentServices;\n\n  constructor(options: Configuration) {\n    this.services = options.services || {};\n    this.inject = options.inject;\n  }\n\n  /**\n   * Inject all registered services.\n   */\n  public injectServices(): void {\n    for (const service of this.inject) {\n      if (!this.checkForPrerequisite(service)) {\n        console.error(`Missing configuration for ${service} service. Could not inject service.`);\n        return;\n      }\n      switch (service) {\n        case 'google-analytics':\n          this.loadGa();\n          break;\n        case 'google-tag-manager':\n          this.loadGtm();\n          break;\n      }\n    }\n    EventBus.emit('services-loaded');\n  }\n\n  /**\n   * Check whether the configuration for a given service can be resolved.\n   * @param service\n   */\n  protected checkForPrerequisite(service: InjectableService): boolean {\n    switch (service) {\n      case 'google-analytics':\n        return (this.services.ga != undefined && this.services.ga.id != undefined);\n      case 'google-tag-manager':\n        return (this.services.gtm != undefined && this.services.gtm.id != undefined);\n    }\n  }\n\n  /**\n   * Dynamically load GTM after consent was given.\n   */\n  protected loadGtm(): void {\n    // Don't load GTM twice.\n    if (this.hasLoadedGtm()) {\n      return;\n    }\n\n    window.dataLayer = window.dataLayer || [];\n    window.dataLayer.push({\n      'gtm.start': new Date().getTime(),\n      'event': 'gtm.js'\n    });\n    const firstScript = document.getElementsByTagName('script')[0];\n    const script = document.createElement('script');\n    script.src = `https://www.googletagmanager.com/gtm.js?id=${this.services.gtm!.id}`;\n    firstScript.parentNode!.insertBefore(script, firstScript);\n  }\n\n  /**\n   * Dynamically load GA after consent was given.\n   */\n  protected loadGa(): void {\n    // Don't load GA twice.\n    if (this.hasLoadedGa()) {\n      return;\n    }\n\n    window.ga = window.ga || function() {\n      (window.ga.q = window.ga.q || []).push(arguments)\n    };\n\n    window.ga.l = +new Date;\n\n    const firstScript = document.getElementsByTagName('script')[0];\n    const script = document.createElement('script');\n    script.src = 'https://www.google-analytics.com/analytics.js';\n    firstScript.parentNode!.insertBefore(script, firstScript);\n\n    window.ga('create', this.services.ga!.id, 'auto');\n    window.ga('send', 'pageview');\n  }\n\n  /**\n   * Check if GTM instance has already been created.\n   */\n  protected hasLoadedGtm(): boolean {\n    const src = `https://www.googletagmanager.com/gtm.js?id=${this.services.gtm!.id}`;\n    return document.querySelector(`script[src=\"${src}\"`) !== null;\n  }\n\n  /**\n   * Check if GA instance has already been created.\n   */\n  protected hasLoadedGa(): boolean {\n    const src = 'https://www.google-analytics.com/analytics.js';\n    return document.querySelector(`script[src=\"${src}\"`) !== null;\n  }\n}\n","import { Configuration, CookieConsentOptions } from '../types';\n\nexport default class ConfigurationResolver {\n  /**\n   * Resolve configuration using some default options.\n   * @param options\n   */\n  public static resolve(options: CookieConsentOptions): Configuration {\n    if (options.domains && Array.isArray(options.domains) === false) {\n      options.domains = <string[]>[options.domains];\n    }\n    if (options.domains && Array.isArray(options.domains)) {\n      options.domains = options.domains.map(domain => domain.startsWith('.') ? domain : `.${domain}`);\n    }\n\n    return Object.assign({\n      domains: this.getDomains(),\n      type: 'opt-in',\n      inject: [],\n    }, options)\n  }\n\n  /**\n   * Resolve the base domain (without subdomains). This solution will only work for ~80-90% of use cases,\n   * in other cases the users will have to manually specify the domain.\n   */\n  protected static getDomains(): string[] {\n    const domains = [];\n    const host = window.location.hostname;\n    const simple = host.match(/(?:[A-Za-z0-9-]+\\.)*([A-Za-z0-9-]+\\.co.uk|\\.com.br|\\.co.jp|\\.com.au)\\b/);\n    if (simple !== null) {\n      domains.push(simple[1]);\n    }\n    const matches = host.match(/(?:[A-Za-z0-9-]+\\.)*([A-Za-z0-9-]+\\.(?:[A-za-z]{2}|[A-Za-z]{3,}))\\b/);\n    if (matches !== null) {\n      domains.push(matches[1]);\n    }\n    domains.push(host);\n    return domains;\n  }\n}\n","import CookieManager from './cookie-manager';\nimport { Configuration, CookieConsentServices } from '../types';\n\nexport default class ConsentRevoke {\n  protected services: CookieConsentServices;\n  protected domains: string[];\n\n  constructor(options: Configuration) {\n    this.services = options.services || {};\n    this.domains = options.domains;\n  }\n\n  /**\n   * Destroy all registered services after opt-out / consent revoke.\n   */\n  public destroyAnalyticsServices(): void {\n    if (this.services.gtm && this.services.gtm.id) {\n      this.destroyGtm();\n    }\n    if (this.services.aam) {\n      this.destroyAam();\n    }\n    if (this.services.navitas) {\n      this.destroyNavitas();\n    }\n    window.location.reload();\n  }\n  /**\n   * Remove all cookies possibly set by GTM.\n   */\n  protected destroyGtm(): void {\n    const simpleCookies = ['_ga', '_gid', '_gat'];\n    for (const cookie of simpleCookies) {\n      for (const domain of this.domains) {\n        CookieManager.removeCookie(cookie, { domain });\n      }\n      CookieManager.removeCookie(cookie);\n    }\n\n    if (this.services.ga && this.services.ga.id) {\n      const compositeCookies = ['_dc_gtm_', '_gac_', '_gat_gtag_', '_gat_'];\n      for (const cookie of compositeCookies) {\n        for (const domain of this.domains) {\n          CookieManager.removeCookie(`${cookie}${this.services.ga.id}`, { domain });\n        }\n        CookieManager.removeCookie(`${cookie}${this.services.ga.id}`);\n      }\n    }\n  }\n\n  /**\n   * Remove all cookies set by Adobe Audience Manager.\n   */\n  protected destroyAam(): void {\n    CookieManager.removeCookie('aam_uuid');\n  }\n\n  /**\n   * Remove all cookies set by Navitas.\n   */\n  protected destroyNavitas(): void {\n    CookieManager.removeCookie('AAMC_navitas_0');\n    CookieManager.removeCookie('DST');\n    CookieManager.removeCookie('demdex');\n    CookieManager.removeCookie('dextp');\n    CookieManager.removeCookie('navitas');\n  }\n}\n","import CookieNotification from './cookie-notification';\nimport CookiePreferences from './cookie-preferences';\nimport CookieManager from './cookie-manager';\nimport ServiceLoader from './service-loader';\nimport { Configuration, CookieConsentOptions } from '../types';\nimport ConfigurationResolver from './configuration-resolver';\nimport EventBus, { EventBusSubscription } from './event-bus';\nimport ConsentRevoke from './consent-revoke';\nimport { CookieAttributes } from 'js-cookie';\n\ndeclare global {\n  const Haven: typeof CookieConsent;\n  interface Window {\n    dataLayer: any[];\n    ga: any;\n    Haven: typeof CookieConsent\n  }\n}\n\nexport default class CookieConsent {\n  protected options: Configuration;\n  protected cookieNotification: CookieNotification;\n  protected cookiePreferences: CookiePreferences;\n  protected cookieManager: CookieManager;\n  protected serviceLoader: ServiceLoader;\n  protected consentRevoke: ConsentRevoke;\n\n  constructor(options: CookieConsentOptions) {\n    const config = ConfigurationResolver.resolve(options);\n    this.cookieNotification = new CookieNotification(config);\n    this.cookiePreferences = new CookiePreferences(config);\n    this.cookieManager = new CookieManager(config);\n    this.serviceLoader = new ServiceLoader(config);\n    this.consentRevoke = new ConsentRevoke(config);\n    this.options = config;\n  }\n\n  public init(): void {\n    document.addEventListener('DOMContentLoaded', () => {\n      this.cookieNotification.init();\n      this.cookiePreferences.init();\n    });\n    this.registerDefaultListeners();\n    this.checkInitialState();\n  }\n\n  protected checkInitialState(): void {\n    if (this.cookieManager.hasFunctionalCookie()) {\n      EventBus.emit('functional-enabled');\n    }\n    if (this.cookieManager.hasAnalyticsEnabled()) {\n      EventBus.emit('analytics-enabled');\n    }\n    if (this.cookieManager.hasMarketingEnabled()) {\n      EventBus.emit('marketing-enabled');\n    }\n  }\n\n  protected registerDefaultListeners(): void {\n    // Inject analytics services once analytics cookies have been accepted\n    EventBus.on('analytics-enabled', () => {\n      if (this.options.inject.length) {\n        this.serviceLoader.injectServices();\n      }\n    });\n    // Remove analytics cookies when analytics cookie consent is revoked\n    EventBus.on('analytics-disabled', () => {\n      this.consentRevoke.destroyAnalyticsServices();\n    });\n  }\n\n  public getOptions(): Configuration {\n    return this.options;\n  }\n\n  /**\n   * Proxy event bus subscription method to the event bus singleton so that users can call this method\n   * anywhere in their application.\n   * @param event\n   * @param callback\n   */\n  public static on(event: string, callback: Function): EventBusSubscription {\n    return EventBus.on(event, callback);\n  }\n\n  public static create(options: CookieConsentOptions): CookieConsent {\n    const haven = new CookieConsent(options);\n    haven.init();\n    return haven;\n  }\n\n  public static removeCookies(cookies: string[], options?: CookieAttributes) {\n    for (const cookie of cookies) {\n      CookieManager.removeCookie(cookie, options);\n    }\n  }\n}\n\n","import CookieManager from './cookie-manager';\nimport CookieNotification from './cookie-notification';\nimport CookiePreferences from './cookie-preferences';\nimport CookieConsent from './cookie-consent';\n\nwindow.Haven = CookieConsent;\n\nexport { CookieManager, CookieNotification, CookiePreferences, CookieConsent };\n"],"names":["factory","extend","i","result","arguments","length","attributes","key","init","converter","api","value","document","path","defaults","expires","Date","setMilliseconds","getMilliseconds","toUTCString","JSON","stringify","test","e","write","encodeURIComponent","String","replace","decodeURIComponent","escape","stringifiedAttributes","attributeName","cookie","cookies","split","rdecode","parts","slice","join","this","json","charAt","name","read","parse","set","get","call","getJSON","apply","remove","withConverter","module","EventBus","event","callback","id","counter","undefined","subscriptions","unsubscribe","_this","payload","_a","Object","keys","_i","_b","prefix","type","CookieManager","Cookies","options","setCookie","getPrefixedCookieName","emit","removeCookie","cookieExists","getCookie","enableFunctionalCookie","enableAnalyticsCookie","enableMarketingCookie","cookieManager","CookieNotification","cookieNotification","getElementById","cookiesAccept","cookiesDecline","hasFunctionalCookie","showCookieNotification","addEventListener","preventDefault","acceptAll","hideCookieNotification","style","display","CookiePreferences","checkboxAnalytics","checkboxMarketing","saveButton","checked","hasMarketingEnabled","enableButton","hasAnalyticsEnabled","saveButtonInitialText","innerText","saveButtonSavedText","dataset","saved","disableButton","disableMarketingCookie","disableAnalyticsCookie","disabled","services","inject","ServiceLoader","service","checkForPrerequisite","console","error","loadGa","loadGtm","ga","gtm","hasLoadedGtm","window","dataLayer","push","getTime","firstScript","getElementsByTagName","script","createElement","src","parentNode","insertBefore","hasLoadedGa","q","l","querySelector","ConfigurationResolver","domains","Array","isArray","map","domain","startsWith","assign","getDomains","host","location","hostname","simple","match","matches","ConsentRevoke","destroyGtm","aam","destroyAam","navitas","destroyNavitas","reload","simpleCookies_1","compositeCookies_1","_c","_e","_d","config","resolve","cookiePreferences","serviceLoader","consentRevoke","CookieConsent","registerDefaultListeners","checkInitialState","on","injectServices","destroyAnalyticsServices","haven","cookies_1","Haven"],"mappings":"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"}